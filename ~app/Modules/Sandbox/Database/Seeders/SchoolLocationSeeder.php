<?php

namespace Modules\Sandbox\Database\Seeders;

use Illuminate\Database\Seeder;
use Illuminate\Support\Facades\DB;

class SchoolLocationSeeder extends Seeder
{
    /**
     * Run the database seeds.
     *
     * @return void
     */
    public function run()
    {
        // อำเภอและตำบลในจังหวัดยะลา
        $locations = [
            // อำเภอเมืองยะลา
            'เมืองยะลา' => [
                'สะเตง', 'ยุโป', 'ลิดล', 'เปาะเส้ง', 'ท่าสาป', 'ลำพะยา', 
                'หน้าถ้ำ', 'เขื่อนบางลาง', 'พร้อมมิตร', 'ตาเซะ', 'บันนังสาเรง'
            ],
            // อำเภอเบตง
            'เบตง' => [
                'เบตง', 'ยะรม', 'ตาเนาะแมเราะ', 'อัยเยอร์เวง', 'ธารน้ำทิพย์'
            ],
            // อำเภอบันนังสตา
            'บันนังสตา' => [
                'บันนังสตา', 'ตาเนาะปูเต๊ะ', 'บาเจาะ', 'เขื่อนบางลาง', 
                'ตลิ่งชัน', 'ถ้ำทะลุ', 'ตาชี', 'เอราวัณ'
            ],
            // อำเภอธารโต
            'ธารโต' => [
                'ธารโต', 'บ้านแหร', 'แม่หวาด', 'คีรีเขต', 'บางลาง', 'ตาลอ'
            ],
            // อำเภอยะหา
            'ยะหา' => [
                'ยะหา', 'ละแอ', 'ปะแต', 'ตาชี', 'บาโร๊ะ', 'กาตอง', 'กาบัง', 'บาโงยซิแน'
            ],
            // อำเภอรามัน
            'รามัน' => [
                'กายูบอเกาะ', 'กาลอ', 'กาลูปัง', 'เกะรอ', 'จะกว๊ะ', 'ตาเนาะปูเต๊ะ',
                'บาลอ', 'บาโร๊ะ', 'บือมัง', 'วังพญา', 'อาซ่อง', 'เนินงาม', 'โกตาบารู'
            ],
            // อำเภอกาบัง
            'กาบัง' => [
                'กาบัง', 'บาละ', 'สะเอะ'
            ],
            // อำเภอกรงปินัง
            'กรงปินัง' => [
                'กรงปินัง', 'สะเดา', 'ห้วยกระทิง', 'ปุโรง', 'สะกำ'
            ]
        ];

        // อัปเดตข้อมูลโรงเรียนทั้งหมดให้มีอำเภอและตำบล
        $schools = DB::table('schools')->whereNull('education_area')->orWhereNull('district')->get();
        
        foreach ($schools as $school) {
            // สุ่มเลือกอำเภอ
            $area = array_rand($locations);
            // สุ่มเลือกตำบลในอำเภอนั้น
            $district = $locations[$area][array_rand($locations[$area])];
            
            DB::table('schools')
                ->where('id', $school->id)
                ->update([
                    'education_area' => $area,
                    'district' => $district,
                    'updated_at' => now()
                ]);
        }
        
        $this->command->info('✅ อัปเดตข้อมูลอำเภอและตำบลสำหรับโรงเรียนทั้งหมดเรียบร้อยแล้ว');
    }
}
